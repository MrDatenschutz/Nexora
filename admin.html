<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Nexora – Datenbankverwaltung</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #0f172a;
        color: #e5e7eb;
        padding: 20px;
    }
    input, button, textarea {
        padding: 8px;
        margin: 5px 0;
        width: 100%;
        max-width: 500px;
        border-radius: 6px;
        border: 1px solid #4b5563;
        background: #1e293b;
        color: white;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        padding: 10px;
        border-bottom: 1px solid #334155;
    }
    tr.duplicate {
        background: #7f1d1d;
    }
    button {
        cursor: pointer;
        background: #38bdf8;
        border: none;
        color: black;
        font-weight: bold;
    }
</style>
</head>
<body>

<h1>Nexora – Datenbankverwaltung</h1>
<p>Verwalte deine pages.txt: Duplikate finden, löschen, hinzufügen, exportieren.</p>

<h2>TXT laden</h2>
<button onclick="loadTXT()">pages.txt laden</button>

<h2>Suche</h2>
<input id="search" placeholder="Suchbegriff eingeben..." oninput="renderTable()">

<h2>Neuen Eintrag hinzufügen</h2>
<input id="newTitle" placeholder="Titel">
<input id="newURL" placeholder="URL">
<input id="newDesc" placeholder="Beschreibung">
<button onclick="addEntry()">Hinzufügen</button>

<h2>Einträge</h2>
<table id="table"></table>

<h2>Exportierte pages.txt</h2>
<textarea id="export" rows="10"></textarea>

<script>
let entries = [];

function loadTXT() {
    fetch("pages.txt?nocache=" + Date.now())
        .then(r => r.text())
        .then(text => {
            entries = text.split("\n")
                .map(l => l.trim())
                .filter(l => l.length > 0)
                .map(l => {
                    const p = l.split("|");
                    return { title: p[0], url: p[1], desc: p[2] };
                });
            renderTable();
        });
}

function renderTable() {
    const search = document.getElementById("search").value.toLowerCase();
    const table = document.getElementById("table");
    table.innerHTML = "<tr><th>Titel</th><th>URL</th><th>Beschreibung</th><th>Aktion</th></tr>";

    const titles = {};
    const urls = {};

    entries.forEach(e => {
        titles[e.title] = (titles[e.title] || 0) + 1;
        urls[e.url] = (urls[e.url] || 0) + 1;
    });

    entries
        .filter(e =>
            e.title.toLowerCase().includes(search) ||
            e.url.toLowerCase().includes(search) ||
            e.desc.toLowerCase().includes(search)
        )
        .forEach((e, i) => {
            const isDup = titles[e.title] > 1 || urls[e.url] > 1;
            const row = document.createElement("tr");
            if (isDup) row.classList.add("duplicate");

            row.innerHTML = `
                <td>${e.title}</td>
                <td>${e.url}</td>
                <td>${e.desc}</td>
                <td><button onclick="deleteEntry(${i})">Löschen</button></td>
            `;
            table.appendChild(row);
        });

    exportTXT();
}

function deleteEntry(i) {
    entries.splice(i, 1);
    renderTable();
}

function addEntry() {
    const t = document.getElementById("newTitle").value.trim();
    const u = document.getElementById("newURL").value.trim();
    const d = document.getElementById("newDesc").value.trim();

    if (!t || !u || !d) return alert("Bitte alle Felder ausfüllen.");

    entries.push({ title: t, url: u, desc: d });

    document.getElementById("newTitle").value = "";
    document.getElementById("newURL").value = "";
    document.getElementById("newDesc").value = "";

    renderTable();
}

function exportTXT() {
    const out = entries.map(e => `${e.title}|${e.url}|${e.desc}`).join("\n");
    document.getElementById("export").value = out;
}
</script>

</body>
</html>